{% load bread_tags crispy_forms_tags crispy_forms_utils crispy_forms_field %}

{% specialspaceless %}
<div>
    <h5>
    {% if formset.max_num > 1 %}
        {% pretty_modelname formset.model True %}
    {% else %}
        {% pretty_modelname formset.model %}
    {% endif %}
    </h5>

    {% include "layout/materialize_forms/errors_formset.html" %}
    {{ formset.management_form }}

    {% if form.non_field_errors %}
        {% for non_field_error in form.non_field_errors %}
             {{ non_field_error }}
        {% endfor %}
    {% endif %}

    <div id="formset_{{ formset.prefix }}_container">
        {% for form in formset %}
            <div class="card-panel" style="position: relative">
                {% crispy form %}
            </div>
        {% endfor %}
    </div>

    <div>
        <a id="add_{{ formset.prefix }}_button" class="btn" onclick="formset_add('{{ formset.prefix }}', '#formset_{{ formset.prefix }}_container');">
            Add {% pretty_modelname formset.model %}
        </a>
    </div>

    <!-- template form to insert new entry when clicking add-button -->
    <div id="empty_{{ formset.prefix }}_form" style="display:none;" class="template-form">
        <div class="card-panel" style="position: relative">
            {% crispy formset.empty_form %}
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", e => init_formset("{{ formset.prefix }}"));
</script>
{% endspecialspaceless %}
